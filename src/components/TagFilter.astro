---
import { CATEGORY_FILTERS } from '../utils/tags';

const { currentLang, currentTag = 'all' } = Astro.props;
---
<div class="flex flex-wrap items-center w-full max-w-6xl mx-auto justify-center gap-2 sm:justify-start md:gap-2 py-1.5">
  {CATEGORY_FILTERS.map(filter => {
    const isAll = filter.id === 'all';
    const isActive = currentTag === filter.id;
    
    let href = `/${currentLang}/tag/${filter.id}`;
    if (isAll) href = `/${currentLang}`;

    return (
      <a 
        href={href}
        data-astro-prefetch="hover"
        class={`filter-link whitespace-nowrap px-3 py-1 rounded-full text-xs font-bold transition-all duration-300 ${
          isActive 
            ? 'active-filter bg-white text-[#005522] border border-white scale-105' 
            : 'text-emerald-50 border border-transparent hover:border-white/50 hover:bg-white/20'
        }`}
      >
        {filter.label}
      </a>
    );
  })}
</div>

<script is:inline>
  // Instant feedback for filter clicks
  function initFilterFeedback() {
    const links = document.querySelectorAll('.filter-link');
    links.forEach(link => {
      link.addEventListener('click', () => {
        // Only run if it's not already active
          if (!link.classList.contains('active-filter')) {
            links.forEach(l => {
              l.classList.remove('active-filter', 'bg-[#005522]', 'text-white', 'shadow-sm', 'border-[#005522]');
              l.classList.add('bg-white', 'text-[#4a5568]', 'border-[#e2e8f0]');
              l.style.opacity = '1';
            });
            link.classList.add('active-filter', 'bg-[#005522]', 'text-white', 'shadow-sm', 'border-[#005522]');
            link.classList.remove('bg-white', 'text-[#4a5568]', 'border-[#e2e8f0]');
            link.style.opacity = '0.7'; // Slight transparency to show it's "loading"
          }
      });
    });
  }

  // Handle both initial load and view transitions
  document.addEventListener('astro:page-load', initFilterFeedback);
</script>

